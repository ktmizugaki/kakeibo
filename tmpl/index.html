<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="icomoon/style.css">
  <link rel="stylesheet" href="css/kakeibo.css">
  <script type="text/javascript" src="js/polyfill.js"></script>
  <script type="text/javascript" src="js/lib.js"></script>
  <script type="text/javascript" src="js/kakeibo.js"></script>
  <script type="text/html" id="template-empty">
  </script>
  <script type="text/html" id="template-kamokus">
    <h2>勘定科目</h2>
    <table border="1">
      <colgroup>
        <col class="col-category">
        <col class="col-kamoku-code">
        <col class="col-kamoku-name">
      </colgroup>
      <thead><tr>
          <th>分類</th>
          <th>コード</th>
          <th>名称</th>
          <th><button class="normal" data-bind="click: addKamoku">追加</button></th>
      </tr></thead>
      <tbody data-bind="foreach: categories"><tr>
          <td data-bind="text: name, attr:{rowspan:kamokus().length+1,colspan:kamokus().length?1:0}"></td>
      </tr><!-- ko foreach: kamokus --><tr>
          <td class="cell-number" data-bind="text: code"></td>
          <td data-bind="text: name"></td>
          <td><button class="normal" data-bind="click: $parents[1].editKamoku">編集</button></td>
      </tr><!-- /ko --></tbody>
    </table>
  </script>
  <script type="text/html" id="template-kamoku-form">
  <!-- ko component: {name:'kamoku-form', params:$data} --><!-- /ko -->
  </script>
  <script type="text/html" id="template-tmpls">
    <h2>ひな形</h2>
    <table border="1">
      <colgroup>
        <col class="col-tmpl-name">
        <col class="col-tmpl-desc">
      </colgroup>
      <thead><tr>
          <th>名称</th>
          <th>説明</th>
          <th><button class="normal" data-bind="click: addTmpl">追加</button></th>
      </tr></thead>
      <tbody data-bind="foreach: tmpls"><tr>
          <td data-bind="text: name"></td>
          <td data-bind="text: desc"></td>
          <td><button class="normal" data-bind="click: $parent.editTmpl">編集</button></td>
      </tr></tbody>
    </table>
  </script>
  <script type="text/html" id="template-tmpl-form">
  <!-- ko component: {name:'tmpl-form', params:$data} --><!-- /ko -->
  </script>
  <script type="text/html" id="template-lists">
    <h2>月仕訳一覧</h2>
    <form action="javascript:void(0)">
      <div class="form-group">
        <button class="normal" type="button" data-bind="click: prevDate">&lt;</button>
        <input id="lists-date" type="text" class="date form-input" data-bind="textInput: date">
        <button class="normal" type="button" data-bind="calendarButton: {date: date}"><span class="icomoon icon-calendar"></button>
        <button class="normal" type="button" data-bind="click: loadAll"><span class="icomoon icon-spinner11"></button>
        <button class="normal" type="button" data-bind="click: nextDate">&gt;</button>
      </div>
    </form>
    <table border="1">
      <colgroup>
        <col class="col-date">
        <col class="col-kamoku-desc">
        <col class="col-amount">
      </colgroup>
      <thead><tr>
          <th>日付</th>
          <th>科目/摘要</th>
          <th>金額</th>
          <th><button class="normal" data-bind="click: dialog.addList">新規</button></th>
      </tr></thead>
      <tbody><!-- ko foreach: lists --><tr data-bind="css:{initial_lists: is_initial}">
          <td data-bind="text: date"></td>
          <td>
            <!-- ko if: repr() -->
            <span class="nobreak" data-bind="text: repr().kamoku().name()"></span>
            <span class="nobreak" data-bind="text: repr().desc"></span>
            <!-- /ko -->
          </td>
          <td class="cell-number" data-bind="text: amount"></td>
          <td><button class="normal" data-bind="click: $parent.dialog.editList">詳細</button></td>
      </tr><!-- /ko --></tbody>
    </table>
  </script>
  <script type="text/html" id="template-list-form">
  <!-- ko component: {name:'list-form', params:$data} --><!-- /ko -->
  </script>
  <script type="text/html" id="template-list2tmpl-form">
  <!-- ko component: {name:'list2tmpl-form', params:$data} --><!-- /ko -->
  </script>
  <script type="text/html" id="template-summary">
    <h2>月集計</h2>
    <form action="javascript:void(0)">
      <div class="form-group">
        <button class="normal" type="button" data-bind="click: prevDate">&lt;</button>
        <input id="lists-date" type="text" class="date form-input" data-bind="value: date">
        <button class="normal" type="button" data-bind="calendarButton: {date: date}"><span class="icomoon icon-calendar"></button>
        <button class="normal" type="button" data-bind="click: load"><span class="icomoon icon-spinner11"></button>
        <button class="normal" type="button" data-bind="click: nextDate">&gt;</button>
        &nbsp;
        <button class="normal" type="button" data-bind="visible: ko.pureComputed(function(){return is_month_str(date());}), click: makeCarryOver">繰越仕訳の作成</button>
      </div>
    </form>
    <table border="1">
      <colgroup>
        <col class="col-category">
        <col class="col-kamoku">
        <col class="col-amount">
        <col class="col-amount">
        <col class="col-amount">
        <col class="col-amount">
        <col class="col-amount">
        <col class="col-amount">
      </colgroup>
      <thead><tr>
          <th>分類</th>
          <th>科目</th>
          <th colspan="1">開始</th>
          <th colspan="2">借方</th>
          <th colspan="2">貸方</th>
          <th colspan="1">計</th>
      </tr></thead>
      <tbody><!-- ko foreach: summary --><tr>
          <td data-bind="text: kamoku().category().name()"></td>
          <td>
            <span data-bind="text: kamoku().code()" style="display:inline-block; width: 3em"></span>
            <span data-bind="text: kamoku().name()" style="display:inline-block; width: 10em"></span>
          </td>
          <td class="cell-number" data-bind="text: initialAmount"></td>
          <td class="cell-number" data-bind="text: kasiLeftAmount"></td>
          <td class="cell-number" data-bind="text: kasiRightAmount"></td>
          <td class="cell-number" data-bind="text: kariLeftAmount"></td>
          <td class="cell-number" data-bind="text: kariRightAmount"></td>
          <td class="cell-number" data-bind="text: finalAmount"></td>
      </tr><!-- /ko --><tr>
          <td colspan="2" class="cell-number">計</td>
          <td class="cell-number" data-bind="text: initialAmount"></td>
          <td class="cell-number" data-bind="text: kasiLeftAmount"></td>
          <td class="cell-number" data-bind="text: kasiRightAmount"></td>
          <td class="cell-number" data-bind="text: kariLeftAmount"></td>
          <td class="cell-number" data-bind="text: kariRightAmount"></td>
          <td class="cell-number" data-bind="text: finalAmount"></td>
      </tr></tbody>
    </table>
  </script>
  <script type="text/html" id="template-carryover-form">
  <!-- ko component: {name:'carryover-form', params:$data} --><!-- /ko -->
  </script>
  <script type="text/html" id="template-bykamoku">
    <h2>科目別</h2>
    <form data-bind="submit: load, with: search">
      <div class="error" data-bind="visible: errors">入力内容に誤りがあります</div>
      <div class="form-group">
        <label for="date-from" class="form-label">期間</label>
        <input id="date-from" type="text" class="month form-input" data-bind="textInput: date_from, css: {error: error_for('date_from')}"><button class="normal" type="button" data-bind="calendarButton: {date: date_from, title: '期間 開始'}"><span class="icomoon icon-calendar"></button> ～ <input id="date-to" type="text" class="month form-input" data-bind="textInput: date_to, css: {error: error_for('date_to')}"><button class="normal" type="button" data-bind="calendarButton: {date: date_to, title: '期間 終了'}"><span class="icomoon icon-calendar"></button>
        <div data-bind="foreach: error_for('date_from')"><span class="error" data-bind="text:$data"></span><br></div>
        <div data-bind="foreach: error_for('date_to')"><span class="error" data-bind="text:$data"></span><br></div>
      </div>
      <div class="form-group">
        <label for="kamoku" class="form-label">科目</label>
        <select id="kamoku" type="text" class="kamoku form-input" data-bind="value: kamoku, options: kamokus, optionsText: function(item){return item.code()+' '+item.name();}, optionsCaption: ' ', css: {error: error_for('kamoku')}"></select>
        <div data-bind="foreach: error_for('kamoku')"><span class="error" data-bind="text:$data"></span><br></div>
      </div>
      <span class="form-group form-submit">
        <button class="normal" type="submit">更新</button>
      </span>
    </form>
    <table border="1">
      <colgroup>
        <col class="col-date">
        <col class="col-kamoku-desc">
        <col class="col-amount">
        <col class="col-amount">
      </colgroup>
      <thead><tr>
          <th>日付</th>
          <th>科目/摘要</th>
          <th>金額</th>
          <th>累計</th>
      </tr></thead>
      <tbody data-bind="foreach: items"><tr data-bind="css:{initial_lists: $data.is_initial}">
          <td data-bind="text: date"></td>
          <td>
            <span class="nobreak" data-bind="text: kamoku().name()"></span>
            <span class="nobreak" data-bind="text: desc"></span>
          </td>
          <td class="cell-number" data-bind="text: dir()*amount()"></td>
          <td class="cell-number" data-bind="text: sum"></td>
      </tr></tbody>
    </table>
  </script>
  <script type="text/html" id="template-datepick-dialog">
    <div data-bind="component: {name: 'calendar', params: params}"></div>
    <form>
      <span class="form-group form-submit">
        <button type="button" class="normal" data-bind="click: apply">決定</button>
        <button type="button" class="normal" data-bind="click: cancel">取り消し</button>
      </span>
    </form>
  </script>
  <title>家計簿</title>
</head>
<body onLoad="page.init()" data-bind="css:{'open-dialog':dialogManager.is_open}">
  <div data-bind="template: tab.tabbar"></div>
  <div id="main" data-bind="template: tab.content"></div>
  <!-- ko template: dialogManager --><!-- /ko -->
</body>
</html>
